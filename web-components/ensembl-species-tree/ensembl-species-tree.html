<!-- TODO : Load via html-imports to ensure dedup -->
<link rel="import" href="http://www.polymer-project.org/components/polymer/polymer.html">
<link rel="import" href="http://www.polymer-project.org/components/core-header-panel/core-header-panel.html">
<link rel="import" href="http://www.polymer-project.org/components/core-toolbar/core-toolbar.html">
<link rel="import" href="http://www.polymer-project.org/components/font-roboto/roboto.html">
<link rel="import" href="http://www.polymer-project.org/components/core-dropdown-menu/core-dropdown-menu.html">
<link rel="import" href="http://www.polymer-project.org/components/core-dropdown/core-dropdown.html">
<link rel="import" href="http://www.polymer-project.org/components/core-item/core-item.html">
<link rel="import" href="http://www.polymer-project.org/components/core-selector/core-selector.html">

<!-- <link rel="import" href="http://www.polymer-project.org/components/paper-icon-button/paper-icon-button.html"> -->
<!-- <link rel="import" href="http://www.polymer-project.org/components/paper-dropdown-menu/paper-dropdown-menu.html"> -->
<!-- <link rel="import" href="http://www.polymer-project.org/components/paper-dropdown/paper-dropdown.html"> -->


<!-- I think we don't need this -->
<!-- <link rel="stylesheet" href="http://emepyc.github.io/tnt/v0/tnt.css" type="text/css" /> -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="../../build/tnt.tree.js"></script>
<script src="theme.js"></script>
<script src="pics.js"></script>

<polymer-element name="species-tree-toolbar" attributes="layout subtree">
  <template>
    <style>
    </style>

    <core-toolbar style="background: #EEEEEE;">

    <!-- Layout -->
      <core-dropdown-menu label="Layout..." style="background: #EEEEEE;">
	<core-dropdown class="dropdown">
	  <core-selector selected="0" on-core-select="{{layoutChange}}">
              <core-item label="Vertical" style="background: #EEEEEE;"></core-item>
              <core-item label="Radial" style="background: #EEEEEE;"></core-item>
          </core-selector>
	</core-dropdown>
      </core-dropdown-menu>

      <!-- Subtrees -->
      <core-dropdown-menu label="Tree..." style="background: #EEEEEE;">
	<core-dropdown class="dropdown">
	  <core-selector selected="0" on-core-select="{{subtreeChange}}">
	    <core-item label="All" style="background: #EEEEEE;"></core-item>
	    <core-item label="Mammals" style="background: #EEEEEE;"></core-item>
	    <core-item label="Sauropsids" style="background: #EEEEEE;"></core-item>
	    <core-item label="Amniotes" style="background: #EEEEEE;"></core-item>
	    <core-item label="Fish" style="background: #EEEEEE;"></core-item>
	  </core-selector>
	</core-dropdown>
      </core-dropdown-menu>

    </core-toolbar>
  </template>
  <script>
    Polymer({
      layoutChange : function (event, detail, sender) {
          if (detail.isSelected) {
            this.layout = detail.item.label;
          }
      },
      subtreeChange : function (event, detail, sender) {
          if (detail.isSelected) {
            this.subtree = detail.item.label;
          }
      }
    });
  </script>
</polymer-element>

<polymer-element name="tnt-species-tree" attributes="layout width subtree">
  <template>
    <div id="mytree"></div>
  </template>
  <script>
    (function () {
    var tree_vis = tnt.tree();
    var theme = tnt_theme();

    Polymer("tnt-species-tree", {
      subtree : "All",
      layout : "Vertical",
      width : 1600,
      subtreeChanged : function () {
         console.log(this.subtree);
      },
      layoutChanged : function () {
        switch (this.layout) {
           case 'Vertical' :
              console.log("Changing layout to Vertical");
              tree_vis.layout(tnt.tree.layout.vertical().width(this.width).scale(false)).duration(1000);
              tree_vis.update();
              break;
           case 'Radial' :
              console.log("Changing layout to Radial");
              tree_vis.layout(tnt.tree.layout.radial().width(this.width).scale(false)).duration(1000);
              tree_vis.update();
              break;
        }
      },
      ready : function () {
        tree_vis.layout(tree_vis.layout().width(this.width).scale(false));
        theme(tree_vis, this.shadowRoot.getElementById("mytree"));
      }
    })
    })();
  </script>
</polymer-element>

<polymer-element name="ensembl-species-tree" noscript>
  <template>
    <species-tree-toolbar layout="{{layout}}" subtree="{{subtree}}"></species-tree-toolbar>
    <tnt-species-tree layout="{{layout}}" subtree="{{subtree}}"></tnt-species-tree>
  </template>
</polymer-element>

